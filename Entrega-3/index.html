<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Pizza Index</title>
        <link rel="icon" href="assets/icons/pizza.svg" type="image/svg+xml">
        <link rel="stylesheet" href="style.css">

    <div class="container">
        <header class="header">
            <h1>
                <img src="assets/icons/pizza.svg" alt="Pizza" class="title-icon">
                Pizza Index
            </h1>
            <p>Detector de pizzas en tiempo real - Vista del Computador</p>
        </header>

            <div class="main-controls">
                <div class="button-group">
                    <button id="local-camera-btn" class="btn-primary">üé• Usar C√°mara Local</button>
                    <button id="stop-camera-btn" class="btn-secondary" style="display: none;">‚èπÔ∏è Detener C√°mara</button>
                </div>
                <div class="button-group">
                    <button id="start-audio-btn" class="btn-primary">üîä Iniciar Audio</button>
                    <button id="stop-audio-btn" class="btn-secondary muted" style="display: none;">üîá Silenciar Todo</button>
                </div>
            </div>

        <div id="video-container">
            <video id="video" autoplay playsinline style="display: none;"></video>
            <canvas id="canvas"></canvas>
            <canvas id="detection-canvas"></canvas>
            <div id="placeholder">
                <p>üì± Esperando conexi√≥n del celular o c√°mara local...</p>
                <p class="small">Haz clic en "+ Connect" para usar celular o "üé• Usar C√°mara Local"</p>
            </div>
        </div>

        <div id="info">
            <div id="status">üîµ Listo para detectar pizzas</div>
            <div id="detection">Ninguna pizza detectada</div>
        </div>

        <!-- EVENTO DETECTADO -->
        <div id="event-display" class="event-display" style="display: none;">
            <div class="event-header">
                <h2 id="event-title">Evento Detectado</h2>
                <button id="clear-event" class="btn-clear">+</button>
            </div>
            <div class="event-content">
                <div class="event-main">
                    <div class="event-emoji" id="event-emoji">üçï</div>
                    <div class="event-details">
                        <h3 id="event-name">Nombre del Evento</h3>
                        <p id="event-date" class="event-date">Fecha</p>
                        <p id="event-category" class="event-category">Categor√≠a</p>
                    </div>
                </div>
                <div class="event-stats">
                    <div class="stat-box">
                        <div class="stat-label">Pizzas Cr√≠ticas</div>
                        <div class="stat-number" id="event-pizzas-criticas">0</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Incremento</div>
                        <div class="stat-number" id="event-incremento">0%</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-label">Gravedad</div>
                        <div class="stat-number" id="event-gravedad">-</div>
                    </div>
                </div>
                <div class="event-description">
                    <p id="event-desc">Descripci√≥n del evento</p>
                </div>
            </div>
        </div>

        <div class="stats-container">
            <h3>ü§ñ Predicciones del Modelo ML (Teachable Machine):</h3>
            <div id="ml-predictions" class="ml-predictions">
                <p class="loading-ml">Cargando modelo...</p>
            </div>
        </div>

        <footer class="footer">
            <p>Proyecto IIC2026 - Visualizaci√≥n de Informaci√≥n 2025</p>
            <p>Usando Protobject Framework para comunicaci√≥n entre dispositivos</p>
        </footer>
    </div>

    <!-- Scripts movidos al final para asegurar que el DOM est√© cargado -->
    <!-- TensorFlow.js y Teachable Machine -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.7.4/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
    
    <!-- Motor de Audio -->
    <script src="https://unpkg.com/tone@14.7.77/build/Tone.js"></script>
    <!-- Datos de eventos -->
    <script src="events.js"></script>
    <script src="audio.js"></script>

    <!-- Scripts de Protobject Framework -->
    <script src="https://app.protobject.com/framework/p.js"></script>
    <script src="config.js"></script>

    <script>
        // ==========================================
        // VARIABLES GLOBALES
        // ==========================================
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const detectionCanvas = document.getElementById('detection-canvas');
        const detectionCtx = detectionCanvas.getContext('2d');
        const video = document.getElementById('video');
        const statusEl = document.getElementById('status');
        const detectionEl = document.getElementById('detection');
        const debugLog = document.getElementById('debug-log');
                    const placeholder = document.getElementById('placeholder');
                    const localCameraBtn = document.getElementById('local-camera-btn');
                    const stopCameraBtn = document.getElementById('stop-camera-btn');
                    const startAudioBtn = document.getElementById('start-audio-btn');
                    const stopAudioBtn = document.getElementById('stop-audio-btn');
                    const mlPredictionsEl = document.getElementById('ml-predictions');
        let frameCount = 0;
        let isConnected = false;
        let localStream = null;
        let animationId = null;

        // Variables para el modelo ML
        let model = null;
        let modelLoaded = false;
        const MODEL_URL = './model.json';
        const METADATA_URL = './metadata.json';

        // Variables para detecci√≥n de eventos
        let eventoActual = null;
        let pixelsPorCm = 20; // Calibraci√≥n inicial (ajustar seg√∫n setup)

        // =======================================================================
        // ASIGNACI√ìN DE CLASES DEL MODELO A EVENTOS
        // 
        // ‚ùó IMPORTANTE: Edita esta secci√≥n para que coincida con tus clases
        // El "nombre de la clase" debe ser EXACTAMENTE el mismo que en Teachable Machine.
        // =======================================================================
        const MODEL_CLASS_MAPPING = {
            // Ejemplo:
            // "Nombre de Clase de Teachable Machine": { color: "ROJO", tama√±o: 15 },
            
            "Class 1": { color: "ROJO", tama√±o: 15 },   // Mapeado a Invasi√≥n de Irak
            "Class 2": { color: "AZUL", tama√±o: 15 },   // Mapeado a 11 de Septiembre
            
            // --- AGREGA TUS OTRAS CLASES AQU√ç ---

        };

        // ==========================================
        // FUNCIONES DE DEBUG
        // ==========================================
        function log(message, type = 'info') {
            console.log(message);
            if (debugLog) {
                const entry = document.createElement('div');
                entry.className = 'log-entry';
                if (type === 'error') entry.classList.add('log-error');
                if (type === 'success') entry.classList.add('log-success');

                const timestamp = new Date().toLocaleTimeString();
                entry.textContent = `[${timestamp}] ${message}`;

                debugLog.appendChild(entry);
                debugLog.scrollTop = debugLog.scrollHeight;

                // Mantener solo los √∫ltimos 50 logs
                while (debugLog.children.length > 50) {
                    debugLog.removeChild(debugLog.firstChild);
                }
            }
        }

        function updateStatus(message, type = 'info') {
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.className = '';
                if (type === 'success') statusEl.classList.add('connected');
                if (type === 'error') statusEl.classList.add('error');
            }
            log(message, type);
        }

        // ==========================================
        // FUNCIONES DE EVENTOS
        // ==========================================
        function mostrarEvento(evento) {
            if (!evento) return;

            eventoActual = evento;
            const display = document.getElementById('event-display');

            // Actualizar contenido
            document.getElementById('event-emoji').textContent = evento.emoji;
            document.getElementById('event-name').textContent = evento.nombre;
            document.getElementById('event-date').textContent = evento.fecha;
            document.getElementById('event-category').textContent = evento.categoria;
            document.getElementById('event-pizzas-criticas').textContent = evento.pizzasCriticas;
            document.getElementById('event-incremento').textContent = evento.incremento + '%';
            document.getElementById('event-gravedad').textContent = TAMA√ëOS_CONFIG[evento.tama√±o].gravedad;
            document.getElementById('event-desc').textContent = evento.descripcion;

            // Aplicar color de categor√≠a
            const colorConfig = COLORES_CONFIG[evento.color];
            display.style.borderColor = colorConfig.hex;
            display.style.borderLeftColor = colorConfig.hex;
            display.style.borderLeftWidth = '6px';

            // Mostrar con animaci√≥n
            display.style.display = 'block';
            setTimeout(() => display.classList.add('show'), 10);

            log(`üéØ Evento detectado: ${evento.nombre} (${evento.color}, ${evento.tama√±o}cm)`, 'success');
            updateStatus(`‚úÖ Evento: ${evento.nombre}`, 'success');
        }

        function cerrarEvento() {
            const display = document.getElementById('event-display');
            display.classList.remove('show');
            setTimeout(() => {
                display.style.display = 'none';
                eventoActual = null;
            }, 300);
            updateStatus('üîµ Listo para detectar pizzas', 'info');
        }

        // Bot√≥n para cerrar evento
        document.getElementById('clear-event').addEventListener('click', cerrarEvento);

        // ==========================================
        // CARGAR MODELO DE TEACHABLE MACHINE
        // ==========================================
        async function cargarModelo() {
            try {
                log('ü§ñ Cargando modelo de TensorFlow...', 'info');
                mlPredictionsEl.innerHTML = '<p class="loading-ml">‚è≥ Cargando modelo ML...</p>';

                // Cargar modelo usando Teachable Machine Library
                model = await tmImage.load(MODEL_URL, METADATA_URL);
                modelLoaded = true;

                log('‚úÖ Modelo ML cargado correctamente!', 'success');
                log(`üìä Clases detectadas: ${model.getClassLabels().join(', ')}`, 'info');

                mlPredictionsEl.innerHTML = `
                    <div class="ml-ready">
                        <p>‚úÖ Modelo cargado</p>
                        <p class="ml-classes">Clases: ${model.getClassLabels().join(', ')}</p>
                    </div>
                `;

            } catch (error) {
                log('‚ùå Error cargando modelo: ' + error.message, 'error');
                mlPredictionsEl.innerHTML = `<p class="error-ml">‚ùå Error cargando modelo</p>`;
                modelLoaded = false;
            }
        }

        // ==========================================
        // HACER PREDICCI√ìN Y MANEJAR L√ìGICA DE EVENTOS
        // ==========================================
        async function predecirConModelo() {
            if (!modelLoaded || !model || !canvas.width) return;

            try {
                // 1. Hacer predicci√≥n usando el canvas actual
                const predictions = await model.predict(canvas);
                predictions.sort((a, b) => b.probability - a.probability);

                // 2. Actualizar la UI de predicciones de ML
                const predHTML = predictions.map((pred, idx) => {
                    const percentage = (pred.probability * 100).toFixed(1);
                    const barWidth = percentage;
                    const isTop = idx === 0;
                    return `
                        <div class="prediction-item ${isTop ? 'top-prediction' : ''}">
                            <div class="prediction-label">${pred.className}</div>
                            <div class="prediction-bar-container">
                                <div class="prediction-bar" style="width: ${barWidth}%"></div>
                            </div>
                            <div class="prediction-value">${percentage}%</div>
                        </div>
                    `;
                }).join('');
                mlPredictionsEl.innerHTML = predHTML;

                // 3. L√≥gica de activaci√≥n de eventos basada en la predicci√≥n
                const topPrediction = predictions[0];
                const confidenceThreshold = 0.95; // Umbral de confianza (95%)

                if (topPrediction && topPrediction.probability > confidenceThreshold) {
                    const detectedClassName = topPrediction.className;
                    const eventConfig = MODEL_CLASS_MAPPING[detectedClassName];

                    if (eventConfig) {
                        const eventoDetectado = buscarEvento(eventConfig.color, eventConfig.tama√±o);

                        if (eventoDetectado) {
                            // Si el evento detectado es diferente al actual, o si no hay ninguno
                            if (!eventoActual || eventoActual.id !== eventoDetectado.id) {
                                AudioEngine.stopAll(); // Detener sonidos anteriores
                                AudioEngine.play(eventoDetectado);
                                mostrarEvento(eventoDetectado);
                            }
                            // Si es el mismo evento, no hacemos nada para no interrumpir el sonido/animaci√≥n
                        }
                    } else {
                        // La clase detectada no tiene un evento mapeado
                        if (eventoActual) {
                            cerrarEvento();
                            AudioEngine.stopAll();
                        }
                    }
                } else {
                    // La confianza es muy baja, no hay detecci√≥n
                    if (eventoActual) {
                        cerrarEvento();
                        AudioEngine.stopAll();
                    }
                }

            } catch (error) {
                console.error('Error en predicci√≥n:', error);
                if (eventoActual) {
                    cerrarEvento();
                    AudioEngine.stopAll();
                }
            }
        }

        
                    // ==========================================
                    // CONTROLES DE AUDIO
                    // ==========================================
                    startAudioBtn.addEventListener('click', async () => {
                        await AudioEngine.start();
                        if (AudioEngine.isStarted) {
                            log('üîä Motor de audio iniciado.', 'success');
                            startAudioBtn.style.display = 'none';
                            stopAudioBtn.style.display = 'inline-block';
                        } else {
                            log('‚ùå El audio no se pudo iniciar. Requiere interacci√≥n del usuario.', 'error');
                        }
                    });
        
                    stopAudioBtn.addEventListener('click', () => {
                        AudioEngine.stopAll();
                        stopAudioBtn.classList.toggle('muted');
                        if (stopAudioBtn.classList.contains('muted')) {
                            stopAudioBtn.textContent = 'üîá Audio Detenido';
                        } else {
                            // This state is not really used as we don't have a resume all function
                            stopAudioBtn.textContent = 'üîä Iniciar Audio';
                        }
                    });
        
                    // ==========================================
                    // C√ÅMARA LOCAL
                    // ==========================================
                    localCameraBtn.addEventListener('click', async () => {
            try {
                log('üé• Iniciando c√°mara local...', 'info');
                updateStatus('üîÑ Accediendo a c√°mara...', 'info');

                localStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                });

                video.srcObject = localStream;
                video.style.display = 'none'; // Ocultar video, solo mostrar canvas
                placeholder.style.display = 'none';
                isConnected = true;

                localCameraBtn.style.display = 'none';
                stopCameraBtn.style.display = 'inline-block';

                updateStatus('üü¢ C√°mara local activa', 'success');
                log('‚úÖ C√°mara local iniciada correctamente', 'success');

                // Procesar frames continuamente
                processLocalCamera();

            } catch (error) {
                log('‚ùå Error accediendo a c√°mara: ' + error.message, 'error');
                updateStatus('‚ùå Error: ' + error.message, 'error');
            }
        });

        stopCameraBtn.addEventListener('click', () => {
            if (localStream) {
                localStream.getTracks().forEach(track => track.stop());
                localStream = null;
                video.srcObject = null;
                isConnected = false;

                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }

                placeholder.style.display = 'flex';
                localCameraBtn.style.display = 'inline-block';
                stopCameraBtn.style.display = 'none';

                updateStatus('üîµ C√°mara detenida', 'info');
                log('‚èπÔ∏è C√°mara local detenida', 'info');
            }
        });

        function processLocalCamera() {
            if (!isConnected || !video.videoWidth) {
                animationId = requestAnimationFrame(processLocalCamera);
                return;
            }

            // Capturar frame del video
            if (canvas.width !== video.videoWidth || canvas.height !== video.videoHeight) {
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                detectionCanvas.width = video.videoWidth;
                detectionCanvas.height = video.videoHeight;
            }

            ctx.drawImage(video, 0, 0);
            frameCount++;
            predecirConModelo();

            animationId = requestAnimationFrame(processLocalCamera);
        }

        // ==========================================
        // RECIBIR MENSAJES DEL CELULAR
        // ==========================================
        Protobject.Core.onReceived(function (message) {
            if (!isConnected) {
                isConnected = true;
                placeholder.style.display = 'none';
                updateStatus('üü¢ Celular conectado! Recibiendo video...', 'success');
                log('üì± Celular conectado exitosamente', 'success');
            }

            if (message && message.type === 'frame') {
                mostrarFrame(message.frame);
            }
        });

        // ==========================================
        // MOSTRAR FRAME DEL CELULAR
        // ==========================================
        function mostrarFrame(frameData) {
            const img = new Image();
            img.onload = () => {
                if (canvas.width !== img.width || canvas.height !== img.height) {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    detectionCanvas.width = img.width;
                    detectionCanvas.height = img.height;
                }

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);

                frameCount++;
                predecirConModelo();
            };
            img.onerror = () => {
                log('‚ùå Error cargando frame', 'error');
            };
            img.src = frameData;
        }

        // ==========================================
        // MOSTRAR FRAME DEL CELULAR
        // ==========================================

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        log('üçï Pizza Index iniciado (Computador)', 'success');
        log('üì± Esperando que el celular se conecte o usar c√°mara local...', 'info');
        updateStatus('üîµ Listo para detectar pizzas', 'info');

        // Cargar modelo de ML
        cargarModelo();
    </script>
</body>

<style>
    /* Personalizar bot√≥n de conexi√≥n */
    #ProtobjectPlusButton {
        width: 120px !important;
        background-color: var(--primary-color) !important;
        border-radius: var(--radius-md) !important;
        font-family: 'Montserrat', sans-serif !important;
        font-weight: 600 !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        gap: 0.5rem !important;
    }

    #ProtobjectPlusButton:hover {
        background-color: var(--primary-hover) !important;
    }

    #ProtobjectPlusButton:after {
        content: ' Conectar';
    }

    .button-group {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin: 1.5rem 0;
        flex-wrap: wrap;
    }

    .btn-primary, .btn-secondary {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 0.75rem 2rem;
        font-size: 1rem;
        font-weight: 600;
        border-radius: var(--radius-md);
        cursor: pointer;
        transition: all var(--transition-normal);
        font-family: 'Montserrat', sans-serif;
    }

    .btn-secondary {
        background: var(--muted-foreground);
    }

    .btn-primary:hover {
        background: var(--primary-hover);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3);
    }

            .btn-secondary:hover {
                background: #4b5563;
                transform: translateY(-2px);
            }
    
            .btn-secondary.muted {
                background: var(--muted);
                color: var(--muted-foreground);
                cursor: not-allowed;
                transform: none;
                text-decoration: line-through;
            }
        .color-tag {
        display: inline-block;
        padding: 0.2rem 0.5rem;
        border-radius: var(--radius-sm);
        font-weight: 600;
        font-size: 0.85rem;
        margin: 0 0.2rem;
    }

    .color-tag.red { background: #fee2e2; color: #dc2626; }
    .color-tag.blue { background: #dbeafe; color: #2563eb; }
    .color-tag.green { background: #dcfce7; color: #059669; }
    .color-tag.purple { background: #f3e8ff; color: #7c3aed; }
    .color-tag.yellow { background: #fef3c7; color: #ca8a04; }

    #placeholder {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        color: var(--muted-foreground);
    }

    #placeholder p {
        margin: 0.5rem 0;
        font-size: 1.1rem;
    }

    #placeholder .small {
        font-size: 0.9rem;
        color: var(--primary-color);
    }

    #detection-canvas {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
    }

    .stats-container {
        background: var(--muted);
        padding: 1.5rem;
        border-radius: var(--radius-lg);
        margin: 1.5rem 0;
        border: 1px solid var(--border);
    }

    .stats-container h3 {
        margin-bottom: 1rem;
        color: var(--foreground);
        font-size: 1.1rem;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
    }

    .stat-item {
        background: white;
        padding: 0.75rem;
        border-radius: var(--radius-sm);
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid var(--border);
    }

    .stat-label {
        font-weight: 500;
        color: var(--muted-foreground);
    }

    .stat-value {
        font-weight: 700;
        font-size: 1.2rem;
        color: var(--primary-color);
    }

    .pizza-detections {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .pizza-item {
        background: white;
        padding: 1rem;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        gap: 1rem;
        border: 1px solid var(--border);
    }

    .pizza-number {
        font-weight: 700;
        color: var(--primary-color);
        font-size: 1.2rem;
    }

    .pizza-color {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        border: 2px solid var(--border);
    }

    .no-detection {
        color: var(--muted-foreground);
        text-align: center;
        padding: 1rem;
        font-style: italic;
    }

    /* Estilos para predicciones ML */
    .ml-predictions {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .loading-ml, .error-ml {
        text-align: center;
        padding: 1rem;
        color: var(--muted-foreground);
        font-style: italic;
    }

    .error-ml {
        color: #dc2626;
    }

    .ml-ready {
        background: white;
        padding: 1rem;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        text-align: center;
    }

    .ml-ready p {
        margin: 0.25rem 0;
    }

    .ml-classes {
        color: var(--primary-color);
        font-weight: 600;
        font-size: 0.9rem;
    }

    .prediction-item {
        background: white;
        padding: 1rem;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border);
        display: grid;
        grid-template-columns: 120px 1fr 80px;
        gap: 1rem;
        align-items: center;
        transition: all var(--transition-normal);
    }

    .prediction-item.top-prediction {
        border: 2px solid var(--primary-color);
        background: linear-gradient(to right, rgba(8, 145, 178, 0.05), white);
        box-shadow: 0 2px 8px rgba(8, 145, 178, 0.1);
    }

    .prediction-label {
        font-weight: 600;
        color: var(--foreground);
        font-size: 1rem;
    }

    .prediction-item.top-prediction .prediction-label {
        color: var(--primary-color);
        font-weight: 700;
        font-size: 1.1rem;
    }

    .prediction-bar-container {
        background: var(--muted);
        height: 24px;
        border-radius: var(--radius-sm);
        overflow: hidden;
        position: relative;
    }

    .prediction-bar {
        background: linear-gradient(to right, var(--primary-color), var(--primary-hover));
        height: 100%;
        border-radius: var(--radius-sm);
        transition: width 0.3s ease;
    }

    .prediction-value {
        font-weight: 700;
        font-size: 1.1rem;
        color: var(--primary-color);
        text-align: right;
    }

    .prediction-item.top-prediction .prediction-value {
        font-size: 1.3rem;
    }

    @media (max-width: 768px) {
        .prediction-item {
            grid-template-columns: 100px 1fr 60px;
            gap: 0.5rem;
            padding: 0.75rem;
        }

        .prediction-label {
            font-size: 0.9rem;
        }

        .prediction-value {
            font-size: 1rem;
        }
    }

    /* Estilos para visualizaci√≥n de evento */
    .event-display {
        background: white;
        border: 2px solid var(--border);
        border-radius: var(--radius-lg);
        margin: 1.5rem 0;
        overflow: hidden;
        opacity: 0;
        transform: translateY(-20px);
        transition: all 0.3s ease;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .event-display.show {
        opacity: 1;
        transform: translateY(0);
    }

    .event-header {
        background: linear-gradient(135deg, var(--primary-color), var(--primary-hover));
        color: white;
        padding: 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .event-header h2 {
        margin: 0;
        font-size: 1.5rem;
        font-weight: 700;
    }

    .btn-clear {
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 2rem;
        font-weight: 200;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        padding-bottom: 4px; /* Ajuste fino para centrar el '+' visualmente */
    }

    .btn-clear:hover {
        background: rgba(0, 0, 0, 0.2);
        transform: rotate(90deg);
    }

    .event-content {
        padding: 2rem;
    }

    .event-main {
        display: flex;
        gap: 2rem;
        align-items: center;
        margin-bottom: 2rem;
    }

    .event-emoji {
        font-size: 4rem;
        line-height: 1;
    }

    .event-details h3 {
        margin: 0 0 0.5rem 0;
        font-size: 1.8rem;
        color: var(--foreground);
    }

    .event-date {
        color: var(--muted-foreground);
        margin: 0.25rem 0;
        font-size: 1rem;
    }

    .event-category {
        display: inline-block;
        background: var(--muted);
        padding: 0.25rem 0.75rem;
        border-radius: var(--radius-sm);
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--primary-color);
        margin-top: 0.5rem;
    }

    .event-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .stat-box {
        background: var(--muted);
        padding: 1rem;
        border-radius: var(--radius-md);
        text-align: center;
        border: 1px solid var(--border);
    }

    .stat-label {
        display: block;
        font-size: 0.85rem;
        color: var(--muted-foreground);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .stat-number {
        display: block;
        font-size: 2rem;
        font-weight: 700;
        color: var(--primary-color);
    }

    .event-description {
        background: var(--muted);
        padding: 1.5rem;
        border-radius: var(--radius-md);
        border-left: 4px solid var(--primary-color);
    }

    .event-description p {
        margin: 0;
        color: var(--foreground);
        line-height: 1.6;
        font-size: 1rem;
    }

    /* Mejoras para pizza-item */
    .pizza-item {
        background: white;
        padding: 1rem;
        border-radius: var(--radius-sm);
        display: grid;
        grid-template-columns: auto auto 1fr;
        align-items: center;
        gap: 1rem;
        border: 1px solid var(--border);
        transition: all 0.2s ease;
    }

    .pizza-item.has-event {
        border-left: 4px solid var(--primary-color);
        background: linear-gradient(to right, rgba(8, 145, 178, 0.05), white);
    }

    .pizza-item:hover {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transform: translateY(-2px);
    }

    .pizza-info {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .pizza-color-name {
        font-weight: 600;
        color: var(--foreground);
    }

    .pizza-event {
        color: var(--primary-color);
        font-weight: 700;
        font-size: 0.95rem;
    }

    .pizza-no-event {
        color: var(--muted-foreground);
        font-size: 0.85rem;
        font-style: italic;
    }

    @media (max-width: 768px) {
        .event-main {
            flex-direction: column;
            text-align: center;
        }

        .event-emoji {
            font-size: 3rem;
        }

        .event-details h3 {
            font-size: 1.4rem;
        }

        .event-stats {
            grid-template-columns: 1fr;
        }

        .stat-number {
            font-size: 1.5rem;
        }

        .pizza-item {
            grid-template-columns: auto;
            gap: 0.5rem;
        }

        .pizza-info {
            grid-column: 1 / -1;
        }
    }
</style>

</html>
